#!/bin/bash

root=$(readlink -f $(dirname $0))
name=$1
shift
cmds=($@)

dir=$root/${name}.demesne
mkdir -pv $dir
ln -vf $root/demesne $dir/$name
ln -svf $dir/$name $dir/.shell
dockerfile=$root/Dockerfile.${name}
[ -f $dockerfile ] || dockerfile=$root/Dockerfile
cp -v $dockerfile $dir/Dockerfile

for cmd in ${cmds[@]}; do
  ln -svf $dir/$name $dir/$cmd
done

cat <<HERE >$dir/.use.sh
export PATH=$dir:\$PATH
HERE
